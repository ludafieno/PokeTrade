{% extends 'base.html' %}
{% block content %}
<div class="container-medium" style="margin-top:3rem; text-align:center;">

  <h1>#{{ pokemon.poke_id }} {{ pokemon.name }}</h1>
  <img src="{{ pokemon.sprite }}"
       alt="{{ pokemon.name }}"
       style="width: 120px; height: 120px; object-fit: contain; margin:1rem 0;">

  <p><strong>Type:</strong> {{ pokemon.types|join:", " }}</p>

  <!-- STAT BARS -->
  <div style="max-width:400px; margin:2rem auto;">
    {% for label, value in stats %}
      <p><strong>{{ label }}:</strong> {{ value }}</p>
      <div style="background:#ddd; border-radius:10px; overflow:hidden; height:20px; margin-bottom:10px;">
        <div style="width:{{ value }}%; background:#4caf50; height:100%;"></div>
      </div>
    {% endfor %}
  </div>

  {# â€”â€”â€” Listing / Buy / Sell UI â€”â€”â€” #}
  {% if user.is_authenticated %}
    {% if pokemon.owner == user.profile %}
      {# I own this PokÃ©mon â€” show â€œList for saleâ€ form #}
      <form method="post" action="{% url 'create_listing' pokemon.pk %}">
        {% csrf_token %}
        <input type="number" name="price" step="0.01" min="1"
               placeholder="Price (e.g. 123.45)" required>
        <button type="submit" class="cta-button">List for Sale</button>
      </form>

    {% else %}
      {# Someone else owns it â€” see if itâ€™s listed #}
      {% with pokemon.listings.first as listing %}
        {% if listing %}
          <h3>Listed for {{ listing.price }} âšªï¸</h3>
          <form method="post" action="{% url 'buy_listing' listing.pk %}">
            {% csrf_token %}
            <button type="submit" class="cta-button">Buy Now</button>
          </form>
        {% else %}
          <p>This PokÃ©mon isnâ€™t on the marketplace.</p>
        {% endif %}
      {% endwith %}
    {% endif %}
  {% endif %}

  <p style="margin-top:2rem;">
    <a href="{% url 'collection' %}" class="cta-button">ğŸ”™ Back to Collection</a>
  </p>

</div>
{% endblock %}